<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Disk Mensagem Studio Neil Marcos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA -->
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/icons/icon-192.png" />

  <!-- Seu CSS principal (j√° existe no projeto) -->
  <link rel="stylesheet" href="/styles.css" />

  <style>
    :root { color-scheme: light dark; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial; background:#0b1220; color:#e5e7eb; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    .brand { font-weight: 800; font-size: clamp(18px, 3vw, 24px); display:flex; align-items:center; gap:10px; }
    .badge { font-size:12px; padding:4px 8px; border-radius:999px; background:#0ea5e9; color:#fff; }
    .card { margin-top:16px; padding:20px; border-radius:16px; background:rgba(255,255,255,.04); box-shadow:0 10px 30px rgba(0,0,0,.25); }
    .muted { opacity:.9; font-size:14px; }
    a.link { color:#93c5fd; text-decoration:none; }
    a.link:hover { text-decoration:underline; }

    /* Bot√£o flutuante de instala√ß√£o */
    #installBtn { position:fixed; right:16px; bottom:16px; padding:12px 16px; border:0; border-radius:999px; font-weight:700; background:#0ea5e9; color:#fff; box-shadow:0 12px 24px rgba(0,0,0,.25); z-index:9999; cursor:pointer; }
    #installBtn[hidden] { display:none; }
    #installBtn:disabled { opacity:.6; cursor:not-allowed; }

    /* Link ‚Äúcontinuar sem instalar‚Äù quando o prompt aparecer */
    #skipLink { display:inline-block; margin-top:12px; }
    #skipLink[hidden] { display:none; }
  </style>
</head>
<body>
  <div class="wrap" id="landing" hidden>
    <div class="brand">
      <span>üì¢ Disk Mensagem Studio Neil Marcos</span>
      <span class="badge">PWA</span>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px 0;">Instalar app?</h2>
      <p class="muted">
        Toque em <b>Instalar app</b> para adicionar o atalho na tela inicial. <br>
        Voc√™ tamb√©m pode <a id="skipLink" class="link" href="/cliente.html">continuar sem instalar</a>.
      </p>
    </div>
  </div>

  <!-- Bot√£o flutuante para instalar o PWA -->
  <button id="installBtn" hidden>Instalar app</button>

  <!-- Registra o Service Worker e l√≥gica de redirecionamento/instala√ß√£o -->
  <script>
    // 1) registra o SW
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js').catch(() => {});
      });
    }

    // 2) l√≥gica do bot√£o "Instalar" + redirecionamento
    (function () {
      const installBtn = document.getElementById('installBtn');
      const landing   = document.getElementById('landing');
      const skipLink  = document.getElementById('skipLink');
      let deferredPrompt = null;

      // redireciona automaticamente para /cliente.html,
      // a menos que o Chrome dispare o beforeinstallprompt.
      let redirectTimer = setTimeout(() => {
        window.location.replace('/cliente.html');
      }, 900); // ~0,9s: abre direto para o Cliente

      // se j√° estiver instalado, nem mostra nada aqui
      const isStandalone =
        window.matchMedia('(display-mode: standalone)').matches ||
        window.navigator.standalone === true;
      if (isStandalone) {
        clearTimeout(redirectTimer);
        window.location.replace('/cliente.html');
        return;
      }

      // quando o app for "instal√°vel", cancelamos o redirecionamento
      // e mostramos o bot√£o de instalar
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;

        // interrompe o redirecionamento autom√°tico
        clearTimeout(redirectTimer);

        // mostra a telinha de "instalar ou continuar"
        landing.hidden = false;
        installBtn.hidden = false;
        if (skipLink) skipLink.hidden = false;
      });

      // clique no bot√£o ‚Üí abre o prompt nativo do Chrome
      if (installBtn) {
        installBtn.addEventListener('click', async () => {
          if (!deferredPrompt) return;
          try {
            installBtn.disabled = true;
            deferredPrompt.prompt();
            await deferredPrompt.userChoice; // { outcome: 'accepted' | 'dismissed' }
          } finally {
            deferredPrompt = null;
            installBtn.disabled = false;
            installBtn.hidden = true;
            // vai para o Cliente depois da tentativa
            window.location.replace('/cliente.html');
          }
        });
      }

      // se o usu√°rio instalar, manda direto para o Cliente
      window.addEventListener('appinstalled', () => {
        window.location.replace('/cliente.html');
      });
    })();
  </script>
</body>
</html>
